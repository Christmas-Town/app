<!DOCTYPE HTML>
<html>
    <head>
        <title>Andrew's self-built 2tothepowerof game</title>
        <style>
            td {
                background: black;
                color: white;
                width:30px;
                height:30px;
                text-align:center;
            }
        </style>
        <script></script>
    </head>
    <body>
        <input type="text" id="sectowaitinput" /><button onclick='alert(document.getElementById("sectowaitinput").value);main(document.getElementById("sectowaitinput").value, 1)'>Start</button>
        <br /><hr /><br />
        <table>
            <tr>
                <td id="1"></td>
                <td id="2"></td>
                <td id="3"></td>
                <td id="4"></td>
            </tr>
            <tr>
                <td id="5"></td>
                <td id="6"></td>
                <td id="7"></td>
                <td id="8"></td>
            </tr>
            <tr>
                <td id="9"></td>
                <td id="10"></td>
                <td id="11"></td>
                <td id="12"></td>
            </tr>
            <tr>
                <td id="13"></td>
                <td id="14"></td>
                <td id="15"></td>
                <td id="16"></td>
            </tr>
        </table>
        <script>
            var blocks = [];
            var delaytime = 5000;
            function addclass() {
                var alltd = document.getElementsByTagName("td");
                for (i=0; i<alltd.length; i++) {
                    alltd[i].className = Math.floor(Number(alltd[i].id)/4);
                }
            }
            function generateblock() {
                console.log("Start generate");
                var posi = Math.floor((Math.random() * 4) + 1);
                var blocknumber = Math.floor((Math.random() * 3) + 1);
                if(blocknumber == 1) {
                    blocknumber = 2;
                } else if(blocknumber == 2) {
                    blocknumber = 4;
                } else if(blocknumber == 3) {
                    blocknumber = 8;
                }
                //blocks.push({post:post, numid: blocknumber});
                var returndata = {posi:posi, numid: blocknumber};
                console.log(returndata);
                return returndata;
            }
            function dropblock(blockdetail) {
                console.log("start dropping");
                console.log(blockdetail);
                var posi = blockdetail.posi;
                var numid = blockdetail.numid;
                document.getElementById(posi).innerHTML = numid;
                //for(i=0; i<3; i++) {
                var timesrunned = 1;
                function drop1tile() {
                    console.log("in "+delaytime);
                    setTimeout(function() {
                        var nowtile = document.getElementById(posi);
                        posi = Number(posi)+4;
                        nowtile.innerHTML = "";
                        document.getElementById(posi).innerHTML = numid;
                        console.log("The block is at position: "+posi+" with number: "+numid);
                        if(timesrunned != 3) {
                            drop1tile();
                        }
                        timesrunned++;
                    }, delaytime);
                }
                drop1tile();
                //}
                console.log("out");
                /*setTimeout(function() {
                    document.getElementById(posi).innerHTML = '';
                }, delaytime);*/
            }
            function main(sectowait, timestorun) {
                delaytime = sectowait*1000;
                console.log(delaytime);
                addclass();
                for(i=0; i<timestorun; i++) {
                    dropblock(generateblock());
                }
            }
        </script>
    </body>
</html>